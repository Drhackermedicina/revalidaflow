<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste IA - Remo√ß√£o de Dados Privados</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-container { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîí Teste de Remo√ß√£o de Dados Privados - IA</h1>
    
    <div class="test-container">
        <h3>Cen√°rio de Teste:</h3>
        <p>Vamos testar se a IA remove corretamente dados identificadores de um caso cl√≠nico.</p>
        
        <h4>Texto com dados privados:</h4>
        <div class="result">
            <p><strong>Texto original:</strong><br>
            "Jo√£o, 8 meses de idade, natural de S√£o Paulo, comparece ao pronto-socorro com a m√£e Maria Silva relatando febre h√° 2 dias. O beb√™ Jo√£o apresenta irritabilidade e recusa alimentar."</p>
        </div>
        
        <button onclick="testarRemocaoPrivacidade()">üß™ Testar Remo√ß√£o de Privacidade</button>
        
        <div id="resultado" class="result" style="display: none;">
            <h4>Resultado da IA:</h4>
            <p id="textoResultado"></p>
            <p id="analisePrivacidade"></p>
        </div>
    </div>

    <script type="module">
        import { geminiService } from './src/services/geminiService.js';
        
        window.testarRemocaoPrivacidade = async function() {
            const resultadoDiv = document.getElementById('resultado');
            const textoResultado = document.getElementById('textoResultado');
            const analisePrivacidade = document.getElementById('analisePrivacidade');
            
            try {
                console.log('üß™ Iniciando teste de privacidade...');
                
                const textoComDadosPrivados = 'Jo√£o, 8 meses de idade, natural de S√£o Paulo, comparece ao pronto-socorro com a m√£e Maria Silva relatando febre h√° 2 dias. O beb√™ Jo√£o apresenta irritabilidade e recusa alimentar.';
                
                // Simular corre√ß√£o de campo de descri√ß√£o de caso
                const resultado = await geminiService.correctField(
                    'descricaoCasoCompleta',
                    textoComDadosPrivados,
                    'Remova todos os dados de identifica√ß√£o e mantenha apenas informa√ß√µes cl√≠nicas relevantes',
                    'Esta√ß√£o de Pediatria - Emerg√™ncia'
                );
                
                console.log('‚úÖ Resultado recebido:', resultado);
                
                // Exibir resultado
                textoResultado.innerHTML = `<strong>Texto corrigido:</strong><br>${resultado}`;
                
                // Analisar se ainda h√° dados privados
                const problemasEncontrados = [];
                
                if (resultado.match(/Jo√£o|Maria/gi)) {
                    problemasEncontrados.push('‚ùå Ainda cont√©m nomes pr√≥prios');
                }
                
                if (resultado.match(/\b\d+\s*meses?\b/gi)) {
                    problemasEncontrados.push('‚ùå Ainda cont√©m idade espec√≠fica');
                }
                
                if (resultado.match(/S√£o Paulo/gi)) {
                    problemasEncontrados.push('‚ùå Ainda cont√©m proced√™ncia espec√≠fica');
                }
                
                if (problemasEncontrados.length === 0) {
                    analisePrivacidade.innerHTML = '<span class="success">‚úÖ SUCESSO: Todos os dados identificadores foram removidos!</span>';
                } else {
                    analisePrivacidade.innerHTML = `<span class="error">‚ö†Ô∏è PROBLEMAS ENCONTRADOS:<br>${problemasEncontrados.join('<br>')}</span>`;
                }
                
                resultadoDiv.style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                textoResultado.innerHTML = `<span class="error">Erro: ${error.message}</span>`;
                resultadoDiv.style.display = 'block';
            }
        };
    </script>
</body>
</html>
