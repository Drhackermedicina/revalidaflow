import { getFirestore, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js';
import { getAuth } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js';
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';

// Substitua pelos seus valores reais do .env
const firebaseConfig = {
  apiKey: "AIzaSyDuakOooHv9a5slO0I3o3gttSBlSXD0aWw",
  authDomain: "revalida-companion.firebaseapp.com",
  projectId: "revalida-companion",
  storageBucket: "revalida-companion.firebasestorage.app",
  messagingSenderId: "772316263153",
  appId: "1:772316263153:web:d0af4ecc404b6ca16a2f50"
};

// Inicializa o Firebase App
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// Obtenha o usu√°rio logado (se houver)
const currentUser = auth.currentUser;

if (currentUser) {
  const candidateUid = 'KiSITAxXMAY5uU3bOPW5JMQPent2'; // UID do candidato do seu log
  const currentUserId = currentUser.uid; // Seu UID do log
  const chatId = [currentUserId, candidateUid].sort().join('_');
  const linkToSend = 'http://localhost:5173/app/station/h7qbnaWEaJAGWMwevDP3/simulate?sessionId=session_1756714132853_n19ms&role=candidate&duration=10&candidateUid=KiSITAxXMAY5uU3bOPW5JMQPent2&candidateName=Ta√≠s+Zocche'; // Link do seu log

  const messageData = {
    senderId: currentUserId,
    senderName: currentUser.displayName || 'Avaliador',
    senderPhotoURL: currentUser.photoURL || '',
    text: `üéØ **Link da Simula√ß√£o**\n\n${candidateUid}, voc√™ foi convidado(a) para participar da simula√ß√£o da esta√ß√£o **Esta√ß√£o**.\n\nClique no link abaixo para acessar:\n${linkToSend}`,
    timestamp: serverTimestamp(),
  };

  try {
    console.log('Tentando adicionar documento ao Firestore...');
    const docRef = await addDoc(collection(db, `chatPrivado_${chatId}`), messageData);
    console.log('Documento adicionado com sucesso! ID:', docRef.id);
  } catch (error) {
    console.error('Erro ao adicionar documento ao Firestore:', error);
  }
} else {
  console.warn('Nenhum usu√°rio logado. Fa√ßa login para testar a escrita no Firestore.');
}
