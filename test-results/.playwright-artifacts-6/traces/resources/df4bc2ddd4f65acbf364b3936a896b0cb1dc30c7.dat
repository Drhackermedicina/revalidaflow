/**
 * WCAG 3.0 APCA perceptual contrast algorithm from https://github.com/Myndex/SAPC-APCA
 * @licence https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 * @see https://www.w3.org/WAI/GL/task-forces/silver/wiki/Visual_Contrast_of_Text_Subgroup
 */
// Types

// MAGICAL NUMBERS

// sRGB Conversion to Relative Luminance (Y)

// Transfer Curve (aka "Gamma") for sRGB linearization
// Simple power curve vs piecewise described in docs
// Essentially, 2.4 best models actual display
// characteristics in combination with the total method
const mainTRC = 2.4;
const Rco = 0.2126729; // sRGB Red Coefficient (from matrix)
const Gco = 0.7151522; // sRGB Green Coefficient (from matrix)
const Bco = 0.0721750; // sRGB Blue Coefficient (from matrix)

// For Finding Raw SAPC Contrast from Relative Luminance (Y)

// Constants for SAPC Power Curve Exponents
// One pair for normal text, and one for reverse
// These are the "beating heart" of SAPC
const normBG = 0.55;
const normTXT = 0.58;
const revTXT = 0.57;
const revBG = 0.62;

// For Clamping and Scaling Values

const blkThrs = 0.03; // Level that triggers the soft black clamp
const blkClmp = 1.45; // Exponent for the soft black clamp curve
const deltaYmin = 0.0005; // Lint trap
const scaleBoW = 1.25; // Scaling for dark text on light
const scaleWoB = 1.25; // Scaling for light text on dark
const loConThresh = 0.078; // Threshold for new simple offset scale
const loConFactor = 12.82051282051282; // = 1/0.078,
const loConOffset = 0.06; // The simple offset
const loClip = 0.001; // Output clip (lint trap #2)

export function APCAcontrast(text, background) {
  // Linearize sRGB
  const Rtxt = (text.r / 255) ** mainTRC;
  const Gtxt = (text.g / 255) ** mainTRC;
  const Btxt = (text.b / 255) ** mainTRC;
  const Rbg = (background.r / 255) ** mainTRC;
  const Gbg = (background.g / 255) ** mainTRC;
  const Bbg = (background.b / 255) ** mainTRC;

  // Apply the standard coefficients and sum to Y
  let Ytxt = Rtxt * Rco + Gtxt * Gco + Btxt * Bco;
  let Ybg = Rbg * Rco + Gbg * Gco + Bbg * Bco;

  // Soft clamp Y when near black.
  // Now clamping all colors to prevent crossover errors
  if (Ytxt <= blkThrs) Ytxt += (blkThrs - Ytxt) ** blkClmp;
  if (Ybg <= blkThrs) Ybg += (blkThrs - Ybg) ** blkClmp;

  // Return 0 Early for extremely low ∆Y (lint trap #1)
  if (Math.abs(Ybg - Ytxt) < deltaYmin) return 0.0;

  // SAPC CONTRAST

  let outputContrast; // For weighted final values
  if (Ybg > Ytxt) {
    // For normal polarity, black text on white
    // Calculate the SAPC contrast value and scale

    const SAPC = (Ybg ** normBG - Ytxt ** normTXT) * scaleBoW;

    // NEW! SAPC SmoothScale™
    // Low Contrast Smooth Scale Rollout to prevent polarity reversal
    // and also a low clip for very low contrasts (lint trap #2)
    // much of this is for very low contrasts, less than 10
    // therefore for most reversing needs, only loConOffset is important
    outputContrast = SAPC < loClip ? 0.0 : SAPC < loConThresh ? SAPC - SAPC * loConFactor * loConOffset : SAPC - loConOffset;
  } else {
    // For reverse polarity, light text on dark
    // WoB should always return negative value.

    const SAPC = (Ybg ** revBG - Ytxt ** revTXT) * scaleWoB;
    outputContrast = SAPC > -loClip ? 0.0 : SAPC > -loConThresh ? SAPC - SAPC * loConFactor * loConOffset : SAPC + loConOffset;
  }
  return outputContrast * 100;
}
                                 
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQVBDQS5tanMiLCJuYW1lcyI6WyJtYWluVFJDIiwiUmNvIiwiR2NvIiwiQmNvIiwibm9ybUJHIiwibm9ybVRYVCIsInJldlRYVCIsInJldkJHIiwiYmxrVGhycyIsImJsa0NsbXAiLCJkZWx0YVltaW4iLCJzY2FsZUJvVyIsInNjYWxlV29CIiwibG9Db25UaHJlc2giLCJsb0NvbkZhY3RvciIsImxvQ29uT2Zmc2V0IiwibG9DbGlwIiwiQVBDQWNvbnRyYXN0IiwidGV4dCIsImJhY2tncm91bmQiLCJSdHh0IiwiciIsIkd0eHQiLCJnIiwiQnR4dCIsImIiLCJSYmciLCJHYmciLCJCYmciLCJZdHh0IiwiWWJnIiwiTWF0aCIsImFicyIsIm91dHB1dENvbnRyYXN0IiwiU0FQQyJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlsL2NvbG9yL0FQQ0EudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBXQ0FHIDMuMCBBUENBIHBlcmNlcHR1YWwgY29udHJhc3QgYWxnb3JpdGhtIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL015bmRleC9TQVBDLUFQQ0FcbiAqIEBsaWNlbmNlIGh0dHBzOi8vd3d3LnczLm9yZy9Db25zb3J0aXVtL0xlZ2FsLzIwMTUvY29weXJpZ2h0LXNvZnR3YXJlLWFuZC1kb2N1bWVudFxuICogQHNlZSBodHRwczovL3d3dy53My5vcmcvV0FJL0dML3Rhc2stZm9yY2VzL3NpbHZlci93aWtpL1Zpc3VhbF9Db250cmFzdF9vZl9UZXh0X1N1Ymdyb3VwXG4gKi9cbi8vIFR5cGVzXG5pbXBvcnQgdHlwZSB7IFJHQiB9IGZyb20gJ0AvdXRpbCdcblxuLy8gTUFHSUNBTCBOVU1CRVJTXG5cbi8vIHNSR0IgQ29udmVyc2lvbiB0byBSZWxhdGl2ZSBMdW1pbmFuY2UgKFkpXG5cbi8vIFRyYW5zZmVyIEN1cnZlIChha2EgXCJHYW1tYVwiKSBmb3Igc1JHQiBsaW5lYXJpemF0aW9uXG4vLyBTaW1wbGUgcG93ZXIgY3VydmUgdnMgcGllY2V3aXNlIGRlc2NyaWJlZCBpbiBkb2NzXG4vLyBFc3NlbnRpYWxseSwgMi40IGJlc3QgbW9kZWxzIGFjdHVhbCBkaXNwbGF5XG4vLyBjaGFyYWN0ZXJpc3RpY3MgaW4gY29tYmluYXRpb24gd2l0aCB0aGUgdG90YWwgbWV0aG9kXG5jb25zdCBtYWluVFJDID0gMi40XG5cbmNvbnN0IFJjbyA9IDAuMjEyNjcyOSAvLyBzUkdCIFJlZCBDb2VmZmljaWVudCAoZnJvbSBtYXRyaXgpXG5jb25zdCBHY28gPSAwLjcxNTE1MjIgLy8gc1JHQiBHcmVlbiBDb2VmZmljaWVudCAoZnJvbSBtYXRyaXgpXG5jb25zdCBCY28gPSAwLjA3MjE3NTAgLy8gc1JHQiBCbHVlIENvZWZmaWNpZW50IChmcm9tIG1hdHJpeClcblxuLy8gRm9yIEZpbmRpbmcgUmF3IFNBUEMgQ29udHJhc3QgZnJvbSBSZWxhdGl2ZSBMdW1pbmFuY2UgKFkpXG5cbi8vIENvbnN0YW50cyBmb3IgU0FQQyBQb3dlciBDdXJ2ZSBFeHBvbmVudHNcbi8vIE9uZSBwYWlyIGZvciBub3JtYWwgdGV4dCwgYW5kIG9uZSBmb3IgcmV2ZXJzZVxuLy8gVGhlc2UgYXJlIHRoZSBcImJlYXRpbmcgaGVhcnRcIiBvZiBTQVBDXG5jb25zdCBub3JtQkcgPSAwLjU1XG5jb25zdCBub3JtVFhUID0gMC41OFxuY29uc3QgcmV2VFhUID0gMC41N1xuY29uc3QgcmV2QkcgPSAwLjYyXG5cbi8vIEZvciBDbGFtcGluZyBhbmQgU2NhbGluZyBWYWx1ZXNcblxuY29uc3QgYmxrVGhycyA9IDAuMDMgLy8gTGV2ZWwgdGhhdCB0cmlnZ2VycyB0aGUgc29mdCBibGFjayBjbGFtcFxuY29uc3QgYmxrQ2xtcCA9IDEuNDUgLy8gRXhwb25lbnQgZm9yIHRoZSBzb2Z0IGJsYWNrIGNsYW1wIGN1cnZlXG5jb25zdCBkZWx0YVltaW4gPSAwLjAwMDUgLy8gTGludCB0cmFwXG5jb25zdCBzY2FsZUJvVyA9IDEuMjUgLy8gU2NhbGluZyBmb3IgZGFyayB0ZXh0IG9uIGxpZ2h0XG5jb25zdCBzY2FsZVdvQiA9IDEuMjUgLy8gU2NhbGluZyBmb3IgbGlnaHQgdGV4dCBvbiBkYXJrXG5jb25zdCBsb0NvblRocmVzaCA9IDAuMDc4IC8vIFRocmVzaG9sZCBmb3IgbmV3IHNpbXBsZSBvZmZzZXQgc2NhbGVcbmNvbnN0IGxvQ29uRmFjdG9yID0gMTIuODIwNTEyODIwNTEyODIgLy8gPSAxLzAuMDc4LFxuY29uc3QgbG9Db25PZmZzZXQgPSAwLjA2IC8vIFRoZSBzaW1wbGUgb2Zmc2V0XG5jb25zdCBsb0NsaXAgPSAwLjAwMSAvLyBPdXRwdXQgY2xpcCAobGludCB0cmFwICMyKVxuXG5leHBvcnQgZnVuY3Rpb24gQVBDQWNvbnRyYXN0ICh0ZXh0OiBSR0IsIGJhY2tncm91bmQ6IFJHQikge1xuICAvLyBMaW5lYXJpemUgc1JHQlxuICBjb25zdCBSdHh0ID0gKHRleHQuciAvIDI1NSkgKiogbWFpblRSQ1xuICBjb25zdCBHdHh0ID0gKHRleHQuZyAvIDI1NSkgKiogbWFpblRSQ1xuICBjb25zdCBCdHh0ID0gKHRleHQuYiAvIDI1NSkgKiogbWFpblRSQ1xuXG4gIGNvbnN0IFJiZyA9IChiYWNrZ3JvdW5kLnIgLyAyNTUpICoqIG1haW5UUkNcbiAgY29uc3QgR2JnID0gKGJhY2tncm91bmQuZyAvIDI1NSkgKiogbWFpblRSQ1xuICBjb25zdCBCYmcgPSAoYmFja2dyb3VuZC5iIC8gMjU1KSAqKiBtYWluVFJDXG5cbiAgLy8gQXBwbHkgdGhlIHN0YW5kYXJkIGNvZWZmaWNpZW50cyBhbmQgc3VtIHRvIFlcbiAgbGV0IFl0eHQgPSAoUnR4dCAqIFJjbykgKyAoR3R4dCAqIEdjbykgKyAoQnR4dCAqIEJjbylcbiAgbGV0IFliZyA9IChSYmcgKiBSY28pICsgKEdiZyAqIEdjbykgKyAoQmJnICogQmNvKVxuXG4gIC8vIFNvZnQgY2xhbXAgWSB3aGVuIG5lYXIgYmxhY2suXG4gIC8vIE5vdyBjbGFtcGluZyBhbGwgY29sb3JzIHRvIHByZXZlbnQgY3Jvc3NvdmVyIGVycm9yc1xuICBpZiAoWXR4dCA8PSBibGtUaHJzKSBZdHh0ICs9IChibGtUaHJzIC0gWXR4dCkgKiogYmxrQ2xtcFxuICBpZiAoWWJnIDw9IGJsa1RocnMpIFliZyArPSAoYmxrVGhycyAtIFliZykgKiogYmxrQ2xtcFxuXG4gIC8vIFJldHVybiAwIEVhcmx5IGZvciBleHRyZW1lbHkgbG93IOKIhlkgKGxpbnQgdHJhcCAjMSlcbiAgaWYgKE1hdGguYWJzKFliZyAtIFl0eHQpIDwgZGVsdGFZbWluKSByZXR1cm4gMC4wXG5cbiAgLy8gU0FQQyBDT05UUkFTVFxuXG4gIGxldCBvdXRwdXRDb250cmFzdDogbnVtYmVyIC8vIEZvciB3ZWlnaHRlZCBmaW5hbCB2YWx1ZXNcbiAgaWYgKFliZyA+IFl0eHQpIHtcbiAgICAvLyBGb3Igbm9ybWFsIHBvbGFyaXR5LCBibGFjayB0ZXh0IG9uIHdoaXRlXG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBTQVBDIGNvbnRyYXN0IHZhbHVlIGFuZCBzY2FsZVxuXG4gICAgY29uc3QgU0FQQyA9ICgoWWJnICoqIG5vcm1CRykgLSAoWXR4dCAqKiBub3JtVFhUKSkgKiBzY2FsZUJvV1xuXG4gICAgLy8gTkVXISBTQVBDIFNtb290aFNjYWxl4oSiXG4gICAgLy8gTG93IENvbnRyYXN0IFNtb290aCBTY2FsZSBSb2xsb3V0IHRvIHByZXZlbnQgcG9sYXJpdHkgcmV2ZXJzYWxcbiAgICAvLyBhbmQgYWxzbyBhIGxvdyBjbGlwIGZvciB2ZXJ5IGxvdyBjb250cmFzdHMgKGxpbnQgdHJhcCAjMilcbiAgICAvLyBtdWNoIG9mIHRoaXMgaXMgZm9yIHZlcnkgbG93IGNvbnRyYXN0cywgbGVzcyB0aGFuIDEwXG4gICAgLy8gdGhlcmVmb3JlIGZvciBtb3N0IHJldmVyc2luZyBuZWVkcywgb25seSBsb0Nvbk9mZnNldCBpcyBpbXBvcnRhbnRcbiAgICBvdXRwdXRDb250cmFzdCA9XG4gICAgICAoU0FQQyA8IGxvQ2xpcCkgPyAwLjBcbiAgICAgIDogKFNBUEMgPCBsb0NvblRocmVzaCkgPyBTQVBDIC0gU0FQQyAqIGxvQ29uRmFjdG9yICogbG9Db25PZmZzZXRcbiAgICAgIDogU0FQQyAtIGxvQ29uT2Zmc2V0XG4gIH0gZWxzZSB7XG4gICAgLy8gRm9yIHJldmVyc2UgcG9sYXJpdHksIGxpZ2h0IHRleHQgb24gZGFya1xuICAgIC8vIFdvQiBzaG91bGQgYWx3YXlzIHJldHVybiBuZWdhdGl2ZSB2YWx1ZS5cblxuICAgIGNvbnN0IFNBUEMgPSAoKFliZyAqKiByZXZCRykgLSAoWXR4dCAqKiByZXZUWFQpKSAqIHNjYWxlV29CXG5cbiAgICBvdXRwdXRDb250cmFzdCA9XG4gICAgICAoU0FQQyA+IC1sb0NsaXApID8gMC4wXG4gICAgICA6IChTQVBDID4gLWxvQ29uVGhyZXNoKSA/IFNBUEMgLSBTQVBDICogbG9Db25GYWN0b3IgKiBsb0Nvbk9mZnNldFxuICAgICAgOiBTQVBDICsgbG9Db25PZmZzZXRcbiAgfVxuXG4gIHJldHVybiBvdXRwdXRDb250cmFzdCAqIDEwMFxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBR0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNQSxPQUFPLEdBQUcsR0FBRztBQUVuQixNQUFNQyxHQUFHLEdBQUcsU0FBUyxFQUFDO0FBQ3RCLE1BQU1DLEdBQUcsR0FBRyxTQUFTLEVBQUM7QUFDdEIsTUFBTUMsR0FBRyxHQUFHLFNBQVMsRUFBQzs7QUFFdEI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsTUFBTSxHQUFHLElBQUk7QUFDbkIsTUFBTUMsT0FBTyxHQUFHLElBQUk7QUFDcEIsTUFBTUMsTUFBTSxHQUFHLElBQUk7QUFDbkIsTUFBTUMsS0FBSyxHQUFHLElBQUk7O0FBRWxCOztBQUVBLE1BQU1DLE9BQU8sR0FBRyxJQUFJLEVBQUM7QUFDckIsTUFBTUMsT0FBTyxHQUFHLElBQUksRUFBQztBQUNyQixNQUFNQyxTQUFTLEdBQUcsTUFBTSxFQUFDO0FBQ3pCLE1BQU1DLFFBQVEsR0FBRyxJQUFJLEVBQUM7QUFDdEIsTUFBTUMsUUFBUSxHQUFHLElB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